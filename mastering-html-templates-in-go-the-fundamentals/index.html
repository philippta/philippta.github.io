<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Mastering HTML templates in Go - The fundamentals - Philipp Tanlak</title><meta name=description content="The main reason why we all like the Go programming language so much is because of its simplicity. And how else could the html/template parser be, than just simple."><meta name=author content><link href=/style.css rel=stylesheet><link href=/custom.css rel=stylesheet><link rel=apple-touch-icon href=/apple-touch-icon.png><link rel=icon href=/favicon.ico><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500,700&display=swap" rel=stylesheet><script>function setTheme(){const a=localStorage.getItem('theme');return a==='dark'?(document.body.classList.add('dark'),"dark"):a==='light'?(document.body.classList.remove('dark'),"light"):window.matchMedia('(prefers-color-scheme: dark)').matches?(document.body.classList.add('dark'),"dark"):"light"}function toggleTheme(a){localStorage.setItem("theme",a),updateThemeButton(setTheme())}function updateThemeButton(a){a==="dark"?(document.getElementById("theme-toggle-dark").style.display="none",document.getElementById("theme-toggle-light").style.display="block"):(document.getElementById("theme-toggle-dark").style.display="block",document.getElementById("theme-toggle-light").style.display="none")}document.addEventListener('readystatechange',a=>{a.target.readyState==="complete"&&document.body.classList.add("transition-delay")})</script></head><body class=single><header class=header><nav class=nav><p class=logo><a href=/>Philipp Tanlak</a></p><ul class=menu><li style=display:flex;align-items:center><svg onclick="toggleTheme('dark');" id="theme-toggle-dark" style="cursor:pointer;display:none" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24" viewBox="0 0 24 24" width="24"><rect fill="none" height="24" width="24"/><path d="M12 7c-2.76.0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55.0 1-.45 1-1s-.45-1-1-1H2c-.55.0-1 .45-1 1s.45 1 1 1zm18 0h2c.55.0 1-.45 1-1s-.45-1-1-1h-2c-.55.0-1 .45-1 1S19.45 13 20 13zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1S11 19.45 11 20zM5.99 4.58c-.39-.39-1.03-.39-1.41.0-.39.39-.39 1.03.0 1.41l1.06 1.06c.39.39 1.03.39 1.41.0s.39-1.03.0-1.41L5.99 4.58zM18.36 16.95c-.39-.39-1.03-.39-1.41.0-.39.39-.39 1.03.0 1.41l1.06 1.06c.39.39 1.03.39 1.41.0.39-.39.39-1.03.0-1.41l-1.06-1.06zM19.42 5.99c.39-.39.39-1.03.0-1.41-.39-.39-1.03-.39-1.41.0l-1.06 1.06c-.39.39-.39 1.03.0 1.41s1.03.39 1.41.0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03.0-1.41-.39-.39-1.03-.39-1.41.0l-1.06 1.06c-.39.39-.39 1.03.0 1.41s1.03.39 1.41.0l1.06-1.06z"/></svg><svg onclick="toggleTheme('light');" id="theme-toggle-light" style="cursor:pointer;display:none" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24" viewBox="0 0 24 24" width="24"><rect fill="none" height="24" width="24"/><path fill="#fff" d="M12 3c-4.97.0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98.0-5.4-2.42-5.4-5.4.0-1.81.89-3.42 2.26-4.4C12.92 3.04 12.46 3 12 3z"/></svg></li><li><a href=https://github.com/philippta>GitHub</a></li><li><a href=/about-me/>About Me</a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Mastering HTML templates in Go - The fundamentals</h1><div class=post-meta>March 11, 2021</div></header><div class=post-content><ul><li><a href=#introduction>Introduction</a></li><li><a href=#the-beauty-of-its-simplicity>The beauty of its simplicity</a></li><li><a href=#parsing-templates>Parsing templates</a><ul><li><a href=#parsing-from-a-string>Parsing from a string</a></li><li><a href=#parsing-from-a-file>Parsing from a file</a></li><li><a href=#parsing-from-an-iofs-eg-embed-package>Parsing from an io.FS (e.g. embed package)</a></li></ul></li><li><a href=#how-values-are-rendered>How values are rendered</a><ul><li><a href=#accessing-structs-slices-and-maps>Accessing structs, slices and maps</a><ul><li><a href=#structs>Structs</a></li><li><a href=#slices>Slices</a></li><li><a href=#maps>Maps</a></li></ul></li></ul></li><li><a href=#control-structures-if-else-if-else>Control structures: If, else if, else</a><ul><li><a href=#truthy-and-falsy>Truthy and falsy</a></li><li><a href=#the-hardest-part-about-conditions>The hardest part about conditions</a></li></ul></li><li><a href=#control-structures-loops>Control structures: Loops</a></li><li><a href=#wrapping-up>Wrapping up</a></li></ul><h2 id=introduction>Introduction</h2><p>For my last post about <a href=/web-frontends-in-go>How I build web frontends in Go</a> I&rsquo;ve received an overwhelmingly amount of feedback on <a href=https://www.reddit.com/r/golang/comments/lzymk9/how_i_build_web_frontends_in_go/>reddit</a>. But one thing I&rsquo;ve noticed is, that there are quite a few people who felt that the <code>html/template</code> package was either very hard to deal with or they did not even know about most of its features.</p><p>The <a href=https://golang.org/pkg/html/template/>official documentation</a> of this package is a bit misleading because most of it is actually <a href=https://golang.org/pkg/text/template/>here</a>, so I can partially understand the reasoning. But with this post, I am trying to clean up with this and transfer all of my knowledge over to you.</p><h2 id=the-beauty-of-its-simplicity>The beauty of its simplicity</h2><p>The main reason why we all like the Go programming language so much is because of its simplicity. And how else could the <code>html/template</code> parser be, than just simple. If we take a look into the <a href=https://github.com/golang/go/blob/master/src/text/template/parse/lex.go#L76-L87>source code of the lexer</a>, there are just 10 <em>keywords</em> (and some additional symbols):</p><pre><code>. (dot), block, define, else, end, if, range, nil, template, with
</code></pre><h2 id=parsing-templates>Parsing templates</h2><p>The <code>html/template</code> package offers three different ways to parse a template, which have all their use cases. But if you pick one, you will probably stick to it throughout your whole project. The three ways are:</p><ol><li>Parsing from a string</li><li>Parsing from a file</li><li>Parsing from an io.FS (e.g. <code>embed</code> package since Go 1.16)</li></ol><h3 id=parsing-from-a-string>Parsing from a string</h3><p>Parsing a raw html string is the most basic way of creating a new template and is very easy to reason about. Note here, that we first have to create a new template instance with <code>template.New("")</code>. The first argument is the reference name of the template and can be used to render different templates from just one instance. However if we have just one parse template per instance, we can just leave the name empty.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#75715e>// Parsing a single template
</span><span style=color:#75715e></span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;html/template&#34;</span>

<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>html</span> = <span style=color:#e6db74>`Hello </span><span style=color:#75715e>{{</span><span style=color:#a6e22e>.</span><span style=color:#75715e>}}</span><span style=color:#e6db74>!`</span>

<span style=color:#a6e22e>tmpl</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>template</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;&#34;</span>).<span style=color:#a6e22e>Parse</span>(<span style=color:#a6e22e>html</span>)
<span style=color:#a6e22e>tmpl</span>.<span style=color:#a6e22e>Execute</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdout</span>, <span style=color:#e6db74>&#34;World&#34;</span>)        <span style=color:#75715e>// Hello World!
</span></code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#75715e>// Parsing multiple templates into a single instance
</span><span style=color:#75715e></span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;html/template&#34;</span>

<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>hello</span> = <span style=color:#e6db74>`Hello </span><span style=color:#75715e>{{</span><span style=color:#a6e22e>.</span><span style=color:#75715e>}}</span><span style=color:#e6db74>!`</span>
<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>hey</span> = <span style=color:#e6db74>`Hey </span><span style=color:#75715e>{{</span><span style=color:#a6e22e>.</span><span style=color:#75715e>}}</span><span style=color:#e6db74>!`</span>

<span style=color:#a6e22e>tmpl</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>template</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;hello&#34;</span>).<span style=color:#a6e22e>Parse</span>(<span style=color:#a6e22e>hello</span>)
<span style=color:#a6e22e>tmpl</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;hey&#34;</span>).<span style=color:#a6e22e>Parse</span>(<span style=color:#a6e22e>hey</span>)

<span style=color:#a6e22e>tmpl</span>.<span style=color:#a6e22e>ExecuteTemplate</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdout</span>, <span style=color:#e6db74>&#34;hello&#34;</span>, <span style=color:#e6db74>&#34;World&#34;</span>) <span style=color:#75715e>// Hello World!
</span><span style=color:#75715e></span><span style=color:#a6e22e>tmpl</span>.<span style=color:#a6e22e>ExecuteTemplate</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdout</span>, <span style=color:#e6db74>&#34;hey&#34;</span>, <span style=color:#e6db74>&#34;World&#34;</span>)   <span style=color:#75715e>// Hey World!
</span></code></pre></div><h3 id=parsing-from-a-file>Parsing from a file</h3><p>Parsing from a file used to be the most common way to initialize template as you could have them separate from your Go code. Using a file instead of a string does not require you to call the <code>.New("")</code> function, as it takes the filename of the template as its name. Also note here that the path to the template file must match with the working directory you&rsquo;re executing your Go program from.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=color:#75715e>&lt;!-- hello.html --&gt;</span>
Hello {{.}}!
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;html/template&#34;</span>

<span style=color:#a6e22e>tmpl</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>template</span>.<span style=color:#a6e22e>ParseFiles</span>(<span style=color:#e6db74>&#34;hello.html&#34;</span>)
<span style=color:#a6e22e>tmpl</span>.<span style=color:#a6e22e>Execute</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdout</span>, <span style=color:#e6db74>&#34;World&#34;</span>) <span style=color:#75715e>// Hello World!
</span></code></pre></div><h3 id=parsing-from-an-iofs-eg-embed-package>Parsing from an io.FS (e.g. embed package)</h3><p>With Go 1.16 and the new <code>io.FS</code> interface a new way to parse templates was introduced. As the <code>embed</code> package allows you to embed a whole directory into you binary and <code>embed.FS</code> implements the <code>io.FS</code> package, we can use it to ship our templates with out Go binary.
This is the go-to way I am personally working with templates in my code.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=color:#75715e>&lt;!-- hello.html --&gt;</span>
Hello {{.}}!
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;html/template&#34;</span>
<span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;embed&#34;</span>

<span style=color:#75715e>//go:embed *.html
</span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>files</span> <span style=color:#a6e22e>embed</span>.<span style=color:#a6e22e>FS</span>

<span style=color:#a6e22e>tmpl</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>template</span>.<span style=color:#a6e22e>ParseFS</span>(<span style=color:#a6e22e>files</span>, <span style=color:#e6db74>&#34;hello.html&#34;</span>)
<span style=color:#a6e22e>tmpl</span>.<span style=color:#a6e22e>Execute</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdout</span>, <span style=color:#e6db74>&#34;World&#34;</span>) <span style=color:#75715e>// Hello World!
</span></code></pre></div><h2 id=how-values-are-rendered>How values are rendered</h2><p>In the previous examples, you&rsquo;ve already seen some snippets on how to render values inside a template, but let me go deeper on this an explain it in more detail.</p><p>When a value like a string is passed into the <code>tmpl.Execute()</code> method call, the template engine will map this value to literal <code>.</code> (dot), as seen within the curly braces <code>{{.}}</code>. It can then be used to just print it out or in an <code>if</code>, <code>range</code>, <code>with</code>, &mldr; instruction.</p><p>Printing out the dot (or basically anything) will follow the same formatting conventions as if you were to print out a value with <code>fmt.Print()</code>. Here are some examples, so you get a better feeling for it:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#75715e>// Template: {{.}}
</span><span style=color:#75715e></span>
<span style=color:#a6e22e>tmpl</span>.<span style=color:#a6e22e>Execute</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdout</span>, <span style=color:#ae81ff>1</span>)                          <span style=color:#75715e>// 1
</span><span style=color:#75715e></span><span style=color:#a6e22e>tmpl</span>.<span style=color:#a6e22e>Execute</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdout</span>, <span style=color:#ae81ff>3.14</span>)                       <span style=color:#75715e>// 3.14
</span><span style=color:#75715e></span><span style=color:#a6e22e>tmpl</span>.<span style=color:#a6e22e>Execute</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdout</span>, <span style=color:#66d9ef>true</span>)                       <span style=color:#75715e>// true
</span><span style=color:#75715e></span><span style=color:#a6e22e>tmpl</span>.<span style=color:#a6e22e>Execute</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdout</span>, <span style=color:#e6db74>&#34;hello&#34;</span>)                    <span style=color:#75715e>// hello
</span><span style=color:#75715e></span><span style=color:#a6e22e>tmpl</span>.<span style=color:#a6e22e>Execute</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdout</span>, []<span style=color:#66d9ef>int</span>{<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>})             <span style=color:#75715e>// [1 2 3]
</span><span style=color:#75715e></span><span style=color:#a6e22e>tmpl</span>.<span style=color:#a6e22e>Execute</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdout</span>, <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>int</span>{<span style=color:#e6db74>&#34;foo&#34;</span>: <span style=color:#ae81ff>1</span>})   <span style=color:#75715e>// map[foo:1]
</span><span style=color:#75715e></span><span style=color:#a6e22e>tmpl</span>.<span style=color:#a6e22e>Execute</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdout</span>, <span style=color:#66d9ef>struct</span>{<span style=color:#a6e22e>X</span> <span style=color:#66d9ef>int</span>; <span style=color:#a6e22e>Y</span> <span style=color:#66d9ef>int</span>}{<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>}) <span style=color:#75715e>// {1 2}
</span></code></pre></div><h3 id=automatic-escaping-of-user-inputs>Automatic escaping of user inputs</h3><p>A crucial part of a HTML templating engine is its capability to deal with unsafe user input. If you for example had a comment section on your web page where users an enter anything they like, the templating engine should be capable of escaping that inputs automatically and therefore making it safe to be rendered. If this were not the case and a user would inject a <code>&lt;script>alert("hacked")&lt;/script></code> into his message, this would be called a XSS attack.</p><p>The <code>html/template</code> package is safe in this case as it prevents these attacks. Let&rsquo;s take a look of what it renders when passing it said message:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#75715e>// Template: &lt;div&gt;{{.}}&lt;/div&gt;
</span><span style=color:#75715e></span><span style=color:#a6e22e>tmpl</span>.<span style=color:#a6e22e>Execute</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdout</span>, <span style=color:#e6db74>`&lt;script&gt;alert(&#34;hacked&#34;)&lt;/script&gt;`</span>)
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=color:#75715e>&lt;!-- Output --&gt;</span>
&lt;<span style=color:#f92672>div</span>&gt;&amp;lt;script&amp;gt;alert(&amp;#34;hacked&amp;#34;)&amp;lt;/script&amp;gt;&lt;/<span style=color:#f92672>div</span>&gt;
</code></pre></div><p>A secret super power of the <code>html/template</code> package is, that it also knows in which context a value is rendered. If we were to render the same message inside a <code>&lt;script></code> tag instead, the message will be escaped differently. This is also true for CSS within a <code>&lt;style></code> tag.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#75715e>// Template: &lt;script&gt;{{.}}&lt;/script&gt;
</span><span style=color:#75715e></span><span style=color:#a6e22e>tmpl</span>.<span style=color:#a6e22e>Execute</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdout</span>, <span style=color:#e6db74>`&lt;script&gt;alert(&#34;hacked&#34;)&lt;/script&gt;`</span>)
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=color:#75715e>&lt;!-- Output --&gt;</span>
&lt;<span style=color:#f92672>script</span>&gt;<span style=color:#e6db74>&#34;\u003cscript\u003ealert(\&#34;hacked\&#34;)\u003c/script\u003e&#34;</span>&lt;/<span style=color:#f92672>script</span>&gt;
</code></pre></div><h3 id=accessing-structs-slices-and-maps>Accessing structs, slices and maps</h3><p>Rendering simple values is easy but not really useful. In most cases you will be passing in more complex data structures such as slices, maps or custom structs, especially when you want to render an entire HTML5 document. In that case you probably have some general page information, user data and slices of content. For that it&rsquo;s really useful to know how you can access all these nested values.</p><h4 id=structs>Structs</h4><p>As we know, the dot holds the current value or a reference to it. We can also use it to access nested properties of that value. Here is an example for a struct:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>Hello {{.Firstname}} {{.Lastname}}
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Person</span> <span style=color:#66d9ef>struct</span> {
    <span style=color:#a6e22e>Firstname</span> <span style=color:#66d9ef>string</span>
    <span style=color:#a6e22e>Lastname</span>  <span style=color:#66d9ef>string</span>
}

<span style=color:#a6e22e>tmpl</span>.<span style=color:#a6e22e>Execute</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdout</span>, <span style=color:#a6e22e>Person</span>{
    <span style=color:#a6e22e>Firstname</span>: <span style=color:#e6db74>&#34;Philipp&#34;</span>,
    <span style=color:#a6e22e>Lastname</span>:  <span style=color:#e6db74>&#34;Tanlak&#34;</span>,
})
</code></pre></div><h4 id=slices>Slices</h4><p>In most cases when you&rsquo;re working with slices, you will range over them and not access their indexes directly. But for completeness I will show it anyway, before we go over to control structures. Accessing a slice index can be achieved by using the inbuilt <code>index</code> template function and it has the following syntax: <code>{{index items itemIndex}}</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>An {{index . 1}} a day keeps the doctor away!
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>tmpl</span>.<span style=color:#a6e22e>Execute</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdout</span>, []<span style=color:#66d9ef>string</span>{<span style=color:#e6db74>&#34;Orange&#34;</span>, <span style=color:#e6db74>&#34;Apple&#34;</span>, <span style=color:#e6db74>&#34;Banana&#34;</span>})
</code></pre></div><h4 id=maps>Maps</h4><p>Similar to slices, maps can be accessed in the very same way using the <code>index</code> template function. But in addition to that, it&rsquo;s also possible to access maps like structs. So here are the two ways to access a map:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>{{index . &#34;GOOG&#34;}}
<span style=color:#75715e>&lt;!-- or --&gt;</span>
{{.GOOG}}
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>tmpl</span>.<span style=color:#a6e22e>Execute</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdout</span>, <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>float32</span>{
    <span style=color:#e6db74>&#34;GOOG&#34;</span>: <span style=color:#ae81ff>2120.24</span>,
    <span style=color:#e6db74>&#34;AAPL&#34;</span>: <span style=color:#ae81ff>121.99</span>,
})
</code></pre></div><h2 id=control-structures-if-else-if-else>Control structures: If, else if, else</h2><p>When using html templates for rendering web pages, you will unlikely get around conditional rendering. It can be useful to display certain content based on if a given value is true or false, e.g. if a user is logged in or if a there are search results for a given search term. To deal with this, the <code>html/template</code> syntax offers the <code>if</code> instruction, which checks if a value is <code>true</code> or <code>false</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>{{if .IsAuthenticated}}
    Hello {{.Username}}!
{{else}}
    Please log in.
{{end}}
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Session</span> <span style=color:#66d9ef>struct</span> {
    <span style=color:#a6e22e>IsAuthenticated</span> <span style=color:#66d9ef>bool</span>
    <span style=color:#a6e22e>Username</span>        <span style=color:#66d9ef>string</span>
}

<span style=color:#a6e22e>tmpl</span>.<span style=color:#a6e22e>Execute</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdout</span>, <span style=color:#a6e22e>Session</span>{
    <span style=color:#a6e22e>IsAuthenticated</span>: <span style=color:#66d9ef>true</span>,
    <span style=color:#a6e22e>Username</span>:        <span style=color:#e6db74>&#34;philipta&#34;</span>,
})
</code></pre></div><p>We can see that ifs are basically just like ifs in Go and there is also an <code>else if</code> to check for other conditions.</p><pre><code>{{else if .OtherVariable}}
</code></pre><p>One thing to note with this <code>if</code> instruction is, that it&rsquo;s simply closed with an <code>end</code> instruction and not something like <code>endif</code>. This is true for all control structures like <code>range</code>, <code>with</code>, <code>template</code>, <code>block</code>, etc.</p><h3 id=truthy-and-falsy>Truthy and falsy</h3><p>When thinking of if conditions in the Go, we&rsquo;re not allowed to have truthy or falsy values in our code. Everything must evaluate to a strict boolean value. This is not the case for Go&rsquo;s html templates. Here we&rsquo;re allowed to check for the truthyness of a value. So we can for example check if a string is empty or filled and put that into the if condition like so:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>{{if .}}
    String contains the value: {{.}}
{{else}}
    String is empty
{{end}}
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>tmpl</span>.<span style=color:#a6e22e>Execute</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdout</span>, <span style=color:#e6db74>&#34;i&#39;m not empty&#34;</span>)
</code></pre></div><p>Here is a list of the most common values you might want to check for truthyness and what it evaluates to:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>true</span>                   =&gt; <span style=color:#66d9ef>true</span>
<span style=color:#66d9ef>false</span>                  =&gt; <span style=color:#66d9ef>false</span>

<span style=color:#e6db74>&#34;foo&#34;</span>                  =&gt; <span style=color:#66d9ef>true</span>
<span style=color:#e6db74>&#34;&#34;</span>                     =&gt; <span style=color:#66d9ef>false</span>

<span style=color:#ae81ff>1</span>                      =&gt; <span style=color:#66d9ef>true</span>
<span style=color:#ae81ff>0</span>                      =&gt; <span style=color:#66d9ef>false</span>

<span style=color:#66d9ef>struct</span>{}               =&gt; <span style=color:#66d9ef>true</span>
<span style=color:#66d9ef>nil</span>                    =&gt; <span style=color:#66d9ef>false</span>

[]<span style=color:#66d9ef>int</span>{<span style=color:#ae81ff>5</span>}               =&gt; <span style=color:#66d9ef>true</span>
[]<span style=color:#66d9ef>int</span>{}                =&gt; <span style=color:#66d9ef>false</span>

<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>int</span>{<span style=color:#e6db74>&#34;A&#34;</span>: <span style=color:#ae81ff>1</span>} =&gt; <span style=color:#66d9ef>true</span>
<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>int</span>{}       =&gt; <span style=color:#66d9ef>false</span>
</code></pre></div><h3 id=the-hardest-part-about-conditions>The hardest part about conditions</h3><p>Now we&rsquo;ve come to the point where most people struggle with and I personally think that it&rsquo;s the hardest part to wrap your head around when working with Go&rsquo;s templating engine. Actually it&rsquo;s pretty simple once you got the hang of it. But if you want to learn anything about templates in Go, this is a must.</p><p>As I&rsquo;ve mentioned in the very beginning of this post, the template syntax is very minimal but actually very powerful. Because of that, when dealing with if statements, we are not allowed to use operators such as <code>&&</code>, <code>||</code>, <code>==</code>, <code>!=</code>, <code>></code>, etc. Therefore we can not have complex expressions like:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=color:#75715e>&lt;!-- does not work --&gt;</span>
{{if .IsAdmin || .HasEditorAccess }}
</code></pre></div><p>But we&rsquo;ve also seen that the <code>html/template</code> package comes with built in functions like <code>index</code> from the slices and maps example. In case you&rsquo;ve wondered, there are more than just that. Here is a list of the most commonly used inbuilt functions and what they are doing:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>and</span>  =&gt;  <span style=color:#a6e22e>x</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>y</span>
<span style=color:#a6e22e>or</span>   =&gt;  <span style=color:#a6e22e>x</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>y</span>
<span style=color:#a6e22e>not</span>  =&gt;  !<span style=color:#a6e22e>x</span>
<span style=color:#a6e22e>eq</span>   =&gt;  <span style=color:#a6e22e>x</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>y</span>
<span style=color:#a6e22e>ne</span>   =&gt;  <span style=color:#a6e22e>x</span> <span style=color:#f92672>!=</span> <span style=color:#a6e22e>y</span>
<span style=color:#a6e22e>lt</span>   =&gt;  <span style=color:#a6e22e>x</span> &lt;  <span style=color:#a6e22e>y</span>
<span style=color:#a6e22e>gt</span>   =&gt;  <span style=color:#a6e22e>x</span> &gt;  <span style=color:#a6e22e>y</span>
<span style=color:#a6e22e>le</span>   =&gt;  <span style=color:#a6e22e>x</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>y</span>
<span style=color:#a6e22e>ge</span>   =&gt;  <span style=color:#a6e22e>x</span> <span style=color:#f92672>&gt;=</span> <span style=color:#a6e22e>y</span>
</code></pre></div><p>With these functions we can replicate any condition we like, just as if we had direct access to the operators I&rsquo;ve mentioned above. So the example from above would be written like:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=color:#75715e>&lt;!-- does not work --&gt;</span>
{{if .IsAdmin || .HasEditorAccess }}

<span style=color:#75715e>&lt;!-- does work --&gt;</span>
{{if or .IsAdmin .HasEditorAccess }}
</code></pre></div><p>If we were to translate this into Go code and these template functions <em>were</em> a thing in Go, it would look like this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>isAdmin</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>hasEditorAccess</span> {}

<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>or</span>(<span style=color:#a6e22e>isAdmin</span>, <span style=color:#a6e22e>hasEditorAccess</span>) {}
</code></pre></div><blockquote><p>So when dealing with templates, think of these conditions as functions or just as if you were writing in the Lisp programming language.</p></blockquote><p>In every template instructions we are also allowed to use parentheses to encapsulate function calls and compose multiple instructions. For example:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>{{if and .IsAuthenticated (or .IsAdmin .HasEditorAccess)}}
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#75715e>// equivalent go code
</span><span style=color:#75715e></span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>isAuthenticated</span> <span style=color:#f92672>&amp;&amp;</span> (<span style=color:#a6e22e>isAdmin</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>hasEditorAccess</span>) {}
</code></pre></div><p>In addition to <code>and</code> and <code>or</code> there is also <code>eq</code>, <code>ne</code>, <code>not</code> and so on&mldr; With that we can build even more complex conditions like this for example:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>{{if eq .PageType &#34;post&#34;}} <span style=color:#75715e>&lt;!-- .PageType == &#34;post&#34; --&gt;</span>
{{if ne &#34;Apple&#34; &#34;Orange&#34;}} <span style=color:#75715e>&lt;!-- &#34;Apple&#34; != &#34;Orange&#34; --&gt;</span>
{{if not (gt 100 20)}}     <span style=color:#75715e>&lt;!-- !(100 &gt; 20)         --&gt;</span>
</code></pre></div><p>If you want to take a look at all the functions in detail, here&rsquo;s the link to the official documentation: <a href=https://golang.org/pkg/text/template/#hdr-Functions>Functions</a></p><p>So once you wrapped you head around this concept, you will be way more productive with the <code>html/template</code> package.</p><h2 id=control-structures-loops>Control structures: Loops</h2><p>Now that you know how complex conditions work, let&rsquo;s quickly take a look at another easy part again, which is: Loops. Loops are very useful when you for example want to render a list of blog posts on a page or just show a list of items. For that, the template engine provides a <code>range</code> instruction.</p><p>The <code>range</code> instruction introduces us to a new concept, which I don&rsquo;t really know the name of ðŸ˜…. But what it does is changing the value inside the dot to the value of the current iterated over item. At first the dot contains the entire slice as its value, but once it enters the range loop, the dot contains the single slice item. Let me show you:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=color:#75715e>&lt;!-- . (dot) is: []string{&#34;Apple&#34;, &#34;Banana&#34;, &#34;Orange&#34;} --&gt;</span>
{{range .}}
    <span style=color:#75715e>&lt;!-- . (dot) is: &#34;Apple&#34; (in 1st iteration)--&gt;</span>
    Value is: {{.}}
{{end}}
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>tmpl</span>.<span style=color:#a6e22e>Execute</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdout</span>, []<span style=color:#66d9ef>string</span>{<span style=color:#e6db74>&#34;Apple&#34;</span>, <span style=color:#e6db74>&#34;Banana&#34;</span>, <span style=color:#e6db74>&#34;Orange&#34;</span>})
</code></pre></div><p>The above example just gives us access to the item values of the slice, but what is also possible is, that we get the index to it as well by using an assignment you know from Go&rsquo;s <code>for i, item := range items</code> loop. Here is an example how we can grab the index and the value using template variables:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>{{range $index, $value := .}}
    At index {{$index}}, there is: {{$value}}
{{end}}
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>tmpl</span>.<span style=color:#a6e22e>Execute</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdout</span>, []<span style=color:#66d9ef>string</span>{<span style=color:#e6db74>&#34;Apple&#34;</span>, <span style=color:#e6db74>&#34;Banana&#34;</span>, <span style=color:#e6db74>&#34;Orange&#34;</span>})
</code></pre></div><p>In Go we can not only range over slices, but also over maps. This is also possible with the range instruction in a template. This basically looks identical to the previous example:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>{{range $ticker, $price := .}}
    Stock price of {{$ticker}} is: {{$price}}
{{end}}
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>tmpl</span>.<span style=color:#a6e22e>Execute</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdout</span>, <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>float32</span>{
    <span style=color:#e6db74>&#34;GOOG&#34;</span>: <span style=color:#ae81ff>2120.24</span>,
    <span style=color:#e6db74>&#34;AAPL&#34;</span>: <span style=color:#ae81ff>121.99</span>,
})
</code></pre></div><h2 id=wrapping-up>Wrapping up</h2><p>In this post we&rsquo;ve talked about the fundamental knowledge you need to know about templating in Go. There is way more to talk about, but as a start this should be enough to digest.</p><p>I can highly recommend you trying out these things and play around with them, as in the next post, we will cover more template instructions like <code>with</code>, <code>template</code>, <code>block</code> and also custom functions.</p><p>Cheers ðŸ‘‹</p></div><footer class=post-footer><ul class=post-tags><li><a href=/tags/go>go</a></li><li><a href=/tags/html>html</a></li></ul></footer></article></main><script>updateThemeButton(setTheme())</script><footer class=footer><span>&copy; 2021 <a href=/>Philipp Tanlak</a></span></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/prism.min.js integrity="sha512-YBk7HhgDZvBxmtOfUdvX0z8IH2d10Hp3aEygaMNhtF8fSOvBZ16D/1bXZTJV6ndk/L/DlXxYStP8jrF77v2MIg==" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-go.min.js integrity="sha512-SgF1uayJ2/8TV+MhLasqygnm++vYRXswmrR2ZAmUCL4pXtf+6KzUgXPpn10Y6xca658sxOQEOsoP3MChfhke5A==" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-diff.min.js integrity="sha512-QHFQ4+gqPck5hEy4UhfKynXlq3U58GuSQli0/+i6o1AcC/6ht6PtwhtkNIurLfshVbaXkPDXdVp8p/eGXfRKIA==" crossorigin=anonymous></script><script></script></body></html>